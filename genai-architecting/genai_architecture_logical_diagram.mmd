flowchart TB
    User([ðŸ‘¤ User]) --> Auth[ðŸ”’ Authentication & Authorization]
    Auth --> Portal[ðŸŽ“ Language Learning Portal]
    Portal --> InputQuery[ðŸ’¬ Query/Interaction]
    
    subgraph Context["ðŸ“š Context Building"]
        InputQuery --> RAG[ðŸ” RAG Pipeline]
        LessonsDB[(ðŸ“— Lessons Database)] --> RAG
        GrammarDB[(ðŸ“˜ Grammar Database)] --> RAG
        UserProgress[(ðŸ“Š User Progress)] --> RAG
    end
    
    RAG --> InputGuard[ðŸ›¡ï¸ Input Guardrails]
    InputGuard --> Cache{âš¡ Cache}
    
    Cache -->|Cache Hit| Response[âœ… Response]
    Cache -->|Cache Miss| Router[ðŸ”€ Model Router]
    
    Router --> TeacherAPI[ðŸ‘¨â€ðŸ« Teacher Model]
    Router --> TranslatorAPI[ðŸ”„ Translator Model]
    Router --> GameAPI[ðŸŽ® Game Model]
    
    TeacherAPI --> Scoring1[ðŸ“Š Evaluation]
    TranslatorAPI --> Scoring2[ðŸ“Š Evaluation]
    GameAPI --> Scoring3[ðŸ“Š Evaluation]
    
    Scoring1 --> OutputGuard[ðŸ›¡ï¸ Output Guardrails]
    Scoring2 --> OutputGuard
    Scoring3 --> OutputGuard
    
    OutputGuard --> Response
    
    Response --> Agents{ðŸ¤ Learning Agents}
    Agents -->|ðŸ“ Feedback| FeedbackAction[âœï¸ Generate Feedback]
    Agents -->|ðŸ“ˆ Progress| ProgressAction[ðŸ“Š Update Progress]
    Agents -->|ðŸ’¡ Hints| HintAction[ðŸ’¡ Provide Hints]
    
    Monitor[ðŸ“ˆ Analytics & Monitoring] -.-> Context
    Monitor -.-> Router
    Monitor -.-> Response
    
    classDef security fill:#ff4f4f,stroke:#333,stroke-width:2px,color:#fff
    classDef monitoring fill:#9370db,stroke:#333,stroke-width:2px,color:#fff
    classDef storage fill:#f4a261,stroke:#333,stroke-width:2px,color:#fff
    classDef model fill:#2ca02c,stroke:#333,stroke-width:2px,color:#fff
    classDef process fill:#1f77b4,stroke:#fff,stroke-width:2px,color:#fff
    classDef cache fill:#f9c74f,stroke:#333,stroke-width:2px,color:#000
    
    class Auth,InputGuard,OutputGuard security
    class Monitor monitoring
    class LessonsDB,GrammarDB,UserProgress storage
    class TeacherAPI,TranslatorAPI,GameAPI model
    class Router,Scoring1,Scoring2,Scoring3,Response,Agents process
    class Cache cache