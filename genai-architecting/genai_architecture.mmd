flowchart TB
User([ðŸ‘¤ User]) --> Auth[ðŸ”’ Authentication & Authorization]
Auth --> InputQuery[ðŸ’¬ User Query]

    subgraph Context["ðŸ“š Context Construction"]
        InputQuery --> RAG[ðŸ” RAG Pipeline]
        DB[(ðŸ—„ï¸ Database)] --> RAG
        VectorDB[(ðŸ“‚ Vector DB)] --> RAG
        WebSearch[ðŸŒ Web Search] --> RAG
    end

    RAG --> InputGuard[ðŸ›¡ï¸ Input Guardrails]
    InputGuard --> Cache{âš¡ Cache}

    Cache -->|Cache Hit| Response[âœ… Response]
    Cache -->|Cache Miss| Router[ðŸ”€ Model Router]

    Router --> ModelAPI1[ðŸ¤– Model API 1]
    Router --> ModelAPI2[ðŸ¤– Model API 2]

    ModelAPI1 --> Scoring1[ðŸ“Š Scoring]
    ModelAPI2 --> Scoring2[ðŸ“Š Scoring]

    Scoring1 --> OutputGuard[ðŸ›¡ï¸ Output Guardrails]
    Scoring2 --> OutputGuard

    OutputGuard --> Response

    Response --> Agents{ðŸ¤ Agents}
    Agents -->|ðŸ“§ Email| EmailAction[ðŸ“© Send Email]
    Agents -->|ðŸ”” Notify| NotifyAction[ðŸ“¢ Notify]
    Agents -->|ðŸ“¦ Update| UpdateAction[ðŸ”„ Update Order]

    Monitor[ðŸ“ˆ Observability & Monitoring] -.-> Context
    Monitor -.-> Router
    Monitor -.-> Response

    classDef security fill:#ff4f4f,stroke:#333,stroke-width:2px,color:#fff
    classDef monitoring fill:#9370db,stroke:#333,stroke-width:2px,color:#fff
    classDef storage fill:#f4a261,stroke:#333,stroke-width:2px,color:#fff
    classDef model fill:#2ca02c,stroke:#333,stroke-width:2px,color:#fff
    classDef process fill:#1f77b4,stroke:#fff,stroke-width:2px,color:#fff
    classDef cache fill:#f9c74f,stroke:#333,stroke-width:2px,color:#000

    class Auth,InputGuard,OutputGuard security
    class Monitor monitoring
    class DB,VectorDB,WebSearch storage
    class ModelAPI1,ModelAPI2 model
    class Router,Scoring1,Scoring2,Response,Agents process
    class Cache cache
